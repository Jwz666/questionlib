<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <title>TBS-data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- DashForge CSS -->
    <link rel="stylesheet" href="../../assets/css/dashforge.css">
    <link rel="stylesheet" href="../../assets/css/dashforge.dashboard.css">
    <link rel="stylesheet" href="../../assets/css/auth.css">
    <link rel="stylesheet" href="../../assets/css/datepicker.css">
    <link rel="stylesheet" href="../../assets/css/jquery-confirm.css">
    <link rel="stylesheet" href="../../assets/ckeditor/plugins/jdmath/mathquill-0.10.1/mathquill.css">
</head>

<body class="page-profile">
<header class="navbar navbar-header navbar-header-fixed">
    <div class="navbar-brand">
        <img src="../../assets/img/TBS%20logo.png" alt="">
    </div><!-- navbar-brand -->
    <div class="navbar-right">
        <div class="dropdown dropdown-profile">
            <a href="" class="dropdown-link" data-toggle="dropdown" data-display="static">
                <div class="avatar-md"><span  id="showUserName"class="avatar-initial rounded-circle">用户</span></div>
            </a>
            <div class="dropdown-menu dropdown-menu-right tx-13">
                <button onclick="exit()" class="dropdown-item">退出登录</button>
                <script>
                    window.onload=function () {
                        $.ajax({
                            async : false,    //表示请求是否异步处理
                            type : "Post",    //请求类型
                            url : "/getCurrentUser",//请求的 URL地址
                            data: null,
                            dataType : "json",//返回的数据类型
                            success: function (data) {
                                currentUser=data.body;
                                $("#showUserName").text(currentUser.userName);
                            },
                            error:function (data) {
                                alert("请刷新重试");
                            }

                        }); }
                    function exit() {
                        $.post("/logout",null,function () {
                            window.location.href="math-signin.html"
                        });
                    }</script>
            </div><!-- dropdown-menu -->
        </div><!-- dropdown -->
    </div><!-- navbar-right -->
</header><!-- navbar -->




<div class="content content-fixed col-xs-12">
    <div class="container pd-x-0 pd-lg-x-10 pd-xl-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-30">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                        <li class="breadcrumb-item"><a href="math-index.html">题库管理</a></li>
                        <li class="breadcrumb-item"><a href="math-exe-index.html">题库分类</a></li>
                        <li class="breadcrumb-item"><a href="math-exe.html">题目列表</a></li>
                        <li class="breadcrumb-item active" aria-current="page">题目编辑</li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="col-12 inputInfo">
            <!--筛选区域开始-->
            <div class="filterArea">
                <div class="summaryAreaPart">
                    <label for="">题目编号</label>
                    <input id="id" disabled="disabled"/>
                    <div class="col-xs-12 _selection inputInfo filterInput">
                        <label for="">题干编辑</label>
                        <!--<textarea id="content" class="form-control" rows="3"></textarea>-->
                        <textarea name="content" id="content" rows="10" cols="80"></textarea>



                    </div>

                    <div class="_selection col-xs-12">
                        <div class="col-xs-12 p-0">
                            <div class="col-xs-6 inputInfo filterInput pl-0">
                                <label for="">题目类型</label>
                                <select id="type" name="" class="form-control">

                                </select>
                            </div>
                        </div>
                    </div>
                    <!--<div class="col-xs-12 _selection inputInfo filterInput mt-3" id="optionTable" >-->
                        <!--<div class="col-xs-12 p-0">-->
                            <!--<div class="col-xs-10 pl-0">选项值</div>-->
                            <!--<div class="col-xs-2 ">-->
                                <!--<a href="#modalBillingInfo" data-toggle="modal" class="outline-none btn btn-sm btn-primary btn-uppercase">添加</a>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="col-xs-12 p-0" id="options">-->
                            <!--<div class="col-xs-4 pl-0">选项名称</div>-->
                            <!--<div class="col-xs-6 pl-0">选项值</div>-->
                            <!--<div class="col-xs-2">操作</div>-->
                        <!--</div>-->

                        <!--<div id="ops"></div>-->
                    <!--</div>-->
                    <div class="col-xs-12 _selection">
                        <label>答案</label>
                        <div class="col-xs-12 p-0" >
                            <textarea id="answer" class="form-control" rows="10" cols="80"></textarea>
                            <!--<div class="col-xs-3">-->
                                <!--<div class="pretty primary smooth"><input id="ii" type="checkbox"-->
                                                                          <!--name="edit_UserclassifiesList"-->
                                                                          <!--value="Organization_Add"><label for="ii"><i-->
                                        <!--class="mdi iconfont"> </i><span class="pd-x-20">A</span></label></div>-->
                            <!--</div>-->
                            <!--<div class="col-xs-3">-->
                                <!--<div class="pretty primary smooth"><input type="checkbox" name="edit_UserclassifiesList"-->
                                                                          <!--value="Organization_Delete"><label><i-->
                                        <!--class="mdi iconfont"> </i><span class="pd-x-20">B</span></label></div>-->
                            <!--</div>-->
                            <!--<div class="col-xs-3">-->
                                <!--<div class="pretty primary smooth"><input type="checkbox" name="edit_UserclassifiesList"-->
                                                                          <!--value="Organization_Edit"><label><i-->
                                        <!--class="mdi iconfont"> </i><span class="pd-x-20">C</span></label></div>-->
                            <!--</div>-->
                            <!--<div class="col-xs-3">-->
                                <!--<div class="pretty primary smooth"><input type="checkbox" name="edit_UserclassifiesList"-->
                                                                          <!--value="Organization_Find"><label><i-->
                                        <!--class="mdi iconfont"> </i><span class="pd-x-20">D</span></label></div>-->
                            <!--</div>-->
                        <!--</div>-->
                    </div>
                    <!--<div class="_selection col-xs-12">-->
                        <!--<div class="col-xs-12 p-0">-->
                            <!--<div class="col-xs-6 inputInfo filterInput pl-0">-->
                                <!--<label for="">考点</label>-->
                                <!--<input type="text" class="form-control">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <div class="col-xs-12 _selection inputInfo filterInput">
                        <label for="">解析</label>
                        <textarea id="analyis" class="form-control" rows="10" cols="80"></textarea>
                    </div>
                    <div class="_selection col-xs-12">
                        <div class="col-xs-12 p-0">
                            <!--<div class="col-xs-6 inputInfo filterInput pl-0">-->
                                <!--<label for="">地区</label>-->
                                <!--<select id="" name="" class="form-control">-->
                                    <!--<option value="a">浙江</option>-->
                                    <!--<option value="b">江苏</option>-->
                                    <!--<option value="c">湖南</option>-->
                                    <!--<option value="d">湖北</option>-->
                                    <!--<option value="c">北京</option>-->
                                    <!--<option value="d">上海</option>-->
                                <!--</select>-->
                            <!--</div>-->
                            <div class="col-xs-6 inputInfo filterInput pr-0">
                                <label for="">年份</label>
                                <input type="text" class="form-control" id="years"/>
                            </div>
                        </div>
                    </div>
                    <div class="_selection col-xs-12">
                        <div class="col-xs-12 p-0">
                            <!--<div class="col-xs-6 inputInfo filterInput pl-0">-->
                                <!--<label for="">分值</label>-->
                                <!--<select id="" name="" class="form-control">-->
                                    <!--<option value="a">2</option>-->
                                    <!--<option value="b">3</option>-->
                                    <!--<option value="c">4</option>-->
                                    <!--<option value="d">5</option>-->
                                    <!--<option value="e">6</option>-->
                                    <!--<option value="f">7</option>-->
                                <!--</select>-->
                            <!--</div>-->
                            <!--<div class="col-xs-6 inputInfo filterInput pr-0">-->
                                <!--<label for="">难度等级</label>-->
                                <!--<select id="" name="" class="form-control">-->
                                    <!--<option value="a">1</option>-->
                                    <!--<option value="b">2</option>-->
                                    <!--<option value="c">3</option>-->
                                    <!--<option value="d">4</option>-->
                                    <!--<option value="e">5</option>-->
                                    <!--<option value="f">6</option>-->
                                    <!--<option value="g">7</option>-->
                                    <!--<option value="h">8</option>-->
                                    <!--<option value="i">9</option>-->
                                    <!--<option value="j">10</option>-->
                                <!--</select>-->
                            <!--</div>-->
                        </div>
                    </div>
                    <div class="_selection col-xs-12  inputInfo filterInput mt-5">
                        <div class="col-xs-2 pl-0">能力点标签</div>

                        <div class="col-xs-8" id="abilityTag">

                        </div>
                        <div class="col-xs-2 ">
                            <a href="#modalBillingInfo1" data-toggle="modal"
                               class="outline-none btn btn-sm btn-primary btn-uppercase">添加</a>
                        </div>
                        <hr style="display: block;float: left;width: 100%;">
                        <div class="col-xs-2 pl-0">知识点标签</div>

                        <div class="col-xs-8"id="intelligenceTag">


                        </div>
                        <div class="col-xs-2 ">
                            <a href="#modalBillingInfo2" data-toggle="modal"
                               class="outline-none btn btn-sm btn-primary btn-uppercase">添加</a>
                        </div>
                    </div>

                    <div class="col-xs-12 mg-b-50">
                        <div class="col-xs-12 p-0 mg-t-30">
                            <div class="col-xs-6 inputInfo filterInput pl-0">
                            </div>
                            <div class="col-xs-3 inputInfo filterInput pr-0">
                                <button class="btn btn-sm pd-x-20 btn-white btn-uppercase" style="width: 100%;"onclick="addOrEdit(0)">
                                    暂存
                                </button>
                            </div>
                            <div class="col-xs-3 inputInfo filterInput pr-0">
                                <button class="btn btn-sm pd-x-20 btn-primary btn-uppercase mg-l-5" style="width: 100%;" onclick="addOrEdit(1)">
                                    提交
                                </button>
                            </div>
                        </div>
                    </div>

                </div>


            </div>


        </div>

    </div>
</div>
<!--筛选区域结束-->
<!--上传、新建、删除-->


</div><!-- container -->
</div><!-- content -->







<footer class="footer">

</footer>
<div class="modal fade" id="modalBillingInfo" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered wd-sm-650" role="document">
        <div class="modal-content">
            <div class="modal-header pd-y-20 pd-x-20 pd-sm-x-30">
                <a href="" role="button" class="close pos-absolute t-15 r-15" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>
                <div class="media align-items-center">
                    <div class="media-body">
                        <h4 class="tx-18 tx-sm-20 mg-b-2">请填写选项</h4>
                    </div>
                </div><!-- media -->
            </div><!-- modal-header -->
            <div class="modal-body pd-sm-t-30 pd-sm-b-40 pd-sm-x-30">

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">选项名称</label>
                    <select name="" class="form-control">
                        <option value="">A</option>
                        <option value="空间想象能力">B</option>
                        <option value="运算能力">C</option>
                        <option value="转换与创造能力">D</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">选项值</label>
                    <select name="" class="form-control">
                        <option value="">1</option>
                        <option value="">2</option>
                        <option value="">3</option>
                        <option value="">4</option>

                    </select>
                </div>
            </div><!-- modal-body -->
            <div class="modal-footer pd-x-20 pd-y-15">
                <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary">保存</button>
            </div>
        </div><!-- modal-content -->
    </div><!-- modal-dialog -->
</div>

<div class="modal fade" id="modalBillingInfo1" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered wd-sm-650" role="document">
        <div class="modal-content">
            <div class="modal-header pd-y-20 pd-x-20 pd-sm-x-30">
                <a href="" role="button" class="close pos-absolute t-15 r-15" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>
                <div class="media align-items-center">
                    <div class="media-body">
                        <h4 class="tx-18 tx-sm-20 mg-b-2">请选择标签</h4>
                    </div>
                </div><!-- media -->
            </div><!-- modal-header -->
            <div class="modal-body pd-sm-t-30 pd-sm-b-40 pd-sm-x-30">

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">核心能力</label>

                    <select name="" class="form-control" id="coreAbility">

                    </select>
                </div>

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">次级能力</label>

                    <select name="" class="form-control" id="otherAbility">


                    </select>
                </div>
            </div><!-- modal-body -->
            <div class="modal-footer pd-x-20 pd-y-15">
                <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary"id="saveAblity">保存</button>
            </div>
        </div><!-- modal-content -->
    </div><!-- modal-dialog -->
</div>


<div class="modal fade" id="modalBillingInfo2" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered wd-sm-650" role="document">
        <div class="modal-content">
            <div class="modal-header pd-y-20 pd-x-20 pd-sm-x-30">
                <a href="" role="button" class="close pos-absolute t-15 r-15" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>
                <div class="media align-items-center">
                    <div class="media-body">
                        <h4 class="tx-18 tx-sm-20 mg-b-2">请选择标签</h4>
                    </div>
                </div><!-- media -->
            </div><!-- modal-header -->
            <div class="modal-body pd-sm-t-30 pd-sm-b-40 pd-sm-x-30">

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">核心知识点</label>
                    <select name="" class="form-control"id="coreIntelligence" >
                    </select>
                </div>

                <div class="form-group">
                    <label class="tx-10 tx-uppercase tx-medium tx-spacing-1 mg-b-5 tx-color-03">次级知识点</label>
                    <select name="" class="form-control"id="otherIntelligence">

                    </select>
                </div>
            </div><!-- modal-body -->
            <div class="modal-footer pd-x-20 pd-y-15">
                <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary"id ="saveIntelligence">保存</button>
            </div>
        </div><!-- modal-content -->
    </div><!-- modal-dialog -->
</div>

<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../lib/feather-icons/feather.min.js"></script>
<script src="../../lib/jquery-confirm/jquery-confirm.min.js"></script>
<script src="../../assets/js/dashforge.js"></script>
<script src="../../assets/js/dashforge.sampledata.js"></script>
<script src="../../assets/ckeditor/ckeditor.js"></script>
<script src="../../assets/js/datepicker.js"></script>
<!--<script src="https://cdn.ckeditor.com/ckeditor5/12.4.0/classic/ckeditor.js"></script>-->
<script>
    $(function(){
        getQuestionType();
        if(getQueryVariable("newQuest")==false){
            getData();
        }else{
            addNewQuestion()
        }
        CKEDITOR.replace( 'content' );
        CKEDITOR.replace( 'answer' );
        CKEDITOR.replace( 'analyis' );
    });

    tagsId=[];

    function getData(){

        var questionInfo = window.location.href;
        console.log('index of ='+questionInfo.indexOf("="));
        if(questionInfo.indexOf("=")!= -1) {
            var twodata = questionInfo.split("="); //截取 url中的“=”,获得“=”后面的参数
            var data = decodeURI(twodata[1]); //decodeURI解码
            var jsonData=JSON.parse(data);
            console.log(jsonData.id);
            dataToTable(jsonData);
        }

    }

    function dataToTable(data) {
        console.log("in data to table");
        console.log(data);
        $("#id").val(data.id);
        $.ajax({
            // async : false,    //表示请求是否异步处理
            type : "get",    //请求类型
            url : "/baseQuestions/getQuestionList",//请求的 URL地址
            data: data,
            dataType : "json",//返回的数据类型
            success: function (data) {
                console.log(data);  //在控制台打印服务器端返回的数据
                if (data.code == '200') {
                    var questionList = data.body;
                    if (questionList.length != 0) {
                        var questionInfo=null;
                        for (var i = 0; i < questionList.length; i++) {
                            questionInfo = questionList[i];
                        }

                        $("#content").text(questionInfo.content);
                        $("#type").val(questionInfo.questionType);
                        $("#answer").val(questionInfo.answer);
                        $("#analyis").text(questionInfo.analysis);
                        $("#years").val(questionInfo.questionDesignTime);
                    } else {
                        alert("暂无数据");
                    }
                }
                if (data.code == '500') {
                    alert(data.message);
                }
            }
        });

    }

    function getQuestionType() {
        $.ajax({
            // async : false,    //表示请求是否异步处理
            type : "get",    //请求类型
            url : "/baseQuestions/getQuestionType",//请求的 URL地址
            dataType : "json",//返回的数据类型
            success: function (data) {
                console.log(data);  //在控制台打印服务器端返回的数据
                if (data.code == '200') {
                   var types=data.body;
                    if(types.length != 0) {
                        for (var i = 0; i < types.length; i++) {

                            $("#type").append(' <option value='+types[i].questionTypeCode+'>'+types[i].questionTypeName+'</option>');
                        }
                    }
                }
                if (data.code == '500') {
                    alert(data.message);
                }
            }
        });


    }

    function addOrEdit(status) {

        var questionInfo={};
        questionInfo.id=$('#id').val();
        questionInfo.content=CKEDITOR.instances.content.getData();
        questionInfo.questionType=$("#type").val();
        questionInfo.status=status;
        if(questionInfo.questionType==-1){
            alert("请修改题目类型");
            return;
        }
        //questionInfo.optionList=
        questionInfo.answer=CKEDITOR.instances.answer.getData();
        questionInfo.analysis=CKEDITOR.instances.analyis.getData();
        questionInfo.questionDesignTime=$("#years").val();
        console.log(questionInfo);
        var flag=vaild(questionInfo);
        if(!flag) {
            return;
        }
        //questionDesignTime
        $.ajax({
            // async : false,    //表示请求是否异步处理
            type : "post",    //请求类型
            url : "/baseQuestions/addOrUpdateQuestion",
            contentType: 'application/json',//请求的 URL地址
            data:JSON.stringify(questionInfo),
            dataType : "json",//返回的数据类型
            success: function (data) {
                console.log(data);  //在控制台打印服务器端返回的数据
                if (data.code == '200') {
                    alert("操作成功");
                    window.location.href="math-exe.html";
                }
                if (data.code == '500') {
                    alert(data.message);
                }
            }
        });
    }


    function vaild(questionInfo) {
        if(questionInfo.content==null || questionInfo.content=='') {
            alert("请添加题干内容");
            return false;
        }
        if(questionInfo.answer==null || questionInfo.answer=='') {
            alert("请添加答案内容");
            return false;
        }
        return true;
    }
    $('#years').datepicker({
        startView: 2,
        minViewMode: 2,
        maxViewMode: 2,
        language: "zh-CN",
        format:"yyyy",
        autoclose: true
    });



</script>
<script src="../../assets/js/exedit.js"></script>

</body>
</html>
